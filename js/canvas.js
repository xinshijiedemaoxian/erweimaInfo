function createQRImage(o,t,e){function l(o){var t,e,l,r;for(t="",l=o.length,e=0;l>e;e++)r=o.charCodeAt(e),r>=1&&127>=r?t+=o.charAt(e):r>2047?(t+=String.fromCharCode(224|r>>12&15),t+=String.fromCharCode(128|r>>6&63),t+=String.fromCharCode(128|r>>0&63)):(t+=String.fromCharCode(192|r>>6&31),t+=String.fromCharCode(128|r>>0&63));return t}e=e?e:h;{var r={text:"",level:"L",width:270,bgwidth:270,margin:10,round:0,isWater:!1,bgColor:"rgba(225,225,225,0)",fgColor:"#000",inptColor:null,ptColor:null,gcColor:null,gradientWay:"0",background:null,foreground:null,logoimg:null,logoType:"border",pinType:0,paintColor:"#f00",fontEffect:"default",fontSize:22,fontFamily:"KaiTi_GB2312",ftColor:null,content:null,rotate:0,ewmtop:0,ewmleft:0,logotop:-100,logoleft:-100,logowidth:0,logoheight:0,fonttop:-100,fontleft:-100},n=r,a=this,g=document.getElementById(o),m=null,w=0,f=null;.9*n.bgwidth}this.drawImage=function(o){o=o||h;var t=g.getContext("2d");g.width=g.height=n.bgwidth;var e="",l=m.length;"rgba(225,225,225,0)"!=n.bgColor?(t.fillStyle=n.bgColor,t.fillRect(n.ewmleft,n.ewmtop,n.width,n.width)):null==n.background&&(t.fillStyle="#FFFFFF",t.fillRect(n.ewmleft,n.ewmtop,n.width,n.width)),w=(n.width-2*n.margin)/l;var i=n.width/2;ewmSizeChange&&u(y,t),n.gcColor&&(f=D(t,n.fgColor,i));for(var a=0;l>a;a++)for(var p=0;l>p;p++)if(s(a,p)){if(0!=n.pinType&&C(a,p,l))continue;e=c[a][p]?n.paintColor:n.ptColor||n.inptColor&&C(a,p,l)?I(a,p,l):n.fgColor,null==n.gcColor||(n.ptColor||n.inptColor)&&C(a,p,l)||(e=f),t.fillStyle=e,t.strokeStyle=e;var S=p*w+n.margin+n.ewmleft,R=a*w+n.margin+n.ewmtop+w/2;t.beginPath(),t.moveTo(S,R),n.isWater?(s(a,p-1)||s(a-1,p)||s(a-1,p-1)?k(t,p,a,0):v(t,p,a,0),s(a-1,p)||s(a,p+1)||s(a-1,p+1)?k(t,p,a,1):v(t,p,a,1),s(a+1,p)||s(a,p+1)||s(a+1,p+1)?k(t,p,a,2):v(t,p,a,2),s(a+1,p)||s(a,p-1)||s(a+1,p-1)?k(t,p,a,3):v(t,p,a,3)):(v(t,p,a,0),v(t,p,a,1),v(t,p,a,2),v(t,p,a,3)),t.closePath(),null!=n.foreground?A(t):(t.fill(),t.stroke())}else n.isWater&&(e=c[a][p]?n.paintColor:n.ptColor||n.inptColor?I(a,p,l):n.fgColor,C(a,p,l)||(s(a-1,p)&&s(a,p-1)&&b(t,p,a,0,e),s(a+1,p)&&s(a,p-1)&&b(t,p,a,3,e),s(a+1,p)&&s(a,p+1)&&b(t,p,a,2,e),s(a-1,p)&&s(a,p+1)&&b(t,p,a,1,e)));t.restore();for(var a=0;a<n.rotate;a++)F(t,0,0,n.width,n.width);if(null!=n.logoimg&&"L"!=n.level){{var y=1;n.width/r.width}switch(logoSizeChange&&d(y,t),n.logoType){case"icon":logo_round(t,n.logoimg,3*y,n.logoleft*y,n.logotop*y,n.logowidth*y,n.logoheight*y);break;case"border":logo_white(t,n.logoimg,3*y,n.logoleft*y,n.logotop*y,n.logowidth*y,n.logoheight*y);break;case"stroke":logo_stroke(t,n.logoimg,3*y,n.logoleft*y,n.logotop*y,n.logowidth*y,n.logoheight*y);break;default:t.drawImage(n.logoimg,n.logoleft*y,n.logotop*y,n.logowidth*y,n.logoheight*y)}}o()},this.changeContent=function(o,t){t=t?t:this.nullFn,n.content=o,this.drawImage()},this.changeText=function(o,t){t=t?t:this.nullFn,n.text=o,p(t)};var h=function(){},d=function(o,t){t.fillStyle="#FFFFFF",t.fillRect(n.logoleft*o-8,n.logotop*o-8,n.logowidth*o+16,n.logoheight*o+16),t.strokeStyle="#000000",t.strokeRect(n.logoleft*o-8,n.logotop*o-8,8,8),t.strokeRect(n.logoleft*o+n.logowidth*o,n.logotop*o-8,8,8),t.strokeRect(n.logoleft*o-8,n.logotop*o+n.logoheight*o,8,8),t.strokeRect(n.logoleft*o+n.logowidth*o,n.logotop*o+n.logoheight*o,8,8)},u=function(o,t){t.strokeStyle="#000000",t.strokeRect(n.ewmleft-8,n.ewmtop-8,n.width+16,n.width+16),t.strokeStyle="#000000",t.strokeRect(n.ewmleft-8,n.ewmtop-8,8,8),t.strokeRect(n.ewmleft+n.width,n.ewmtop-8,8,8),t.strokeRect(n.ewmleft-8,n.ewmtop+n.width,8,8),t.strokeRect(n.ewmleft+n.width,n.ewmtop+n.width,8,8),t.fillStyle="#FFFFFF",t.fillRect(n.ewmleft-8,n.ewmtop-8,8,8),t.fillRect(n.ewmleft+n.width,n.ewmtop-8,8,8),t.fillRect(n.ewmleft-8,n.ewmtop+n.width,8,8),t.fillRect(n.ewmleft+n.width,n.ewmtop+n.width,8,8)},p=function(o,t){o=o||h;var e=new QRCode(-1,QRErrorCorrectLevel[n.level]);e.addData(l(n.text)),e.make(),m=e.modules;var r=e.getModuleCount();for(c=[],i=0;r>i;i++)c[i]=[];t!==!0&&a.drawImage(),o()},s=function(o,t){var e=m.length;return!(0>o||0>t||o>=e||t>=e)&&m[o][t]},C=function(o,t,e){var l=0;return o>=2&&5>o&&t>=2&&5>t?l=1:7>o&&7>t?l=1:o>=e-5&&e-2>o&&t>=2&5>t?l=1:o>=e-7&&e>o&&t>=0&7>t?l=1:o>=2&&5>o&&t>=e-5&e-2>t?l=1:o>=0&&7>o&&t>=e-7&e>t&&(l=1),l},k=function(o,t,e,l){var r=0,i=0;switch(l){case 0:r=t*w+n.margin+n.ewmleft,i=e*w+n.margin+n.ewmtop,o.lineTo(r,i);break;case 1:r=t*w+w+n.margin+n.ewmleft,i=e*w+n.margin+n.ewmtop,o.lineTo(r,i);break;case 2:r=t*w+w+n.margin+n.ewmleft,i=e*w+w+n.margin+n.ewmtop,o.lineTo(r,i);break;case 3:r=t*w+n.margin+n.ewmleft,i=e*w+w+n.margin+n.ewmtop,o.lineTo(r,i)}},v=function(o,t,e,l){var r=0,i=0;switch(l){case 0:r=t*w+n.round+n.margin+n.ewmleft,i=e*w+n.round+n.margin+n.ewmtop,o.arc(r,i,n.round,Math.PI,1.5*Math.PI,!1),r=t*w+w/2+n.margin+n.ewmleft,i=e*w+n.margin+n.ewmtop,o.lineTo(r,i);break;case 1:r=t*w+w-n.round+n.margin+n.ewmleft,i=e*w+n.round+n.margin+n.ewmtop,o.arc(r,i,n.round,1.5*Math.PI,2*Math.PI,!1);break;case 2:r=t*w+w-n.round+n.margin+n.ewmleft,i=e*w+w-n.round+n.margin+n.ewmtop,o.arc(r,i,n.round,0,Math.PI/2,!1);break;case 3:r=t*w+n.round+n.margin+n.ewmleft,i=e*w+w-n.round+n.margin+n.ewmtop,o.arc(r,i,n.round,Math.PI/2,Math.PI,!1)}},b=function(o,t,e,l,r){{var i,a;n.width/2}switch(o.beginPath(),null!=n.gcColor&&(r=f),o.fillStyle=r,o.strokeStyle=r,l){case 0:i=t*w+n.round+n.margin+n.ewmleft,a=e*w+n.round+n.margin+n.ewmtop,o.arc(i,a,n.round,Math.PI,1.5*Math.PI,!1),i=t*w+n.margin+n.ewmleft,a=e*w+n.margin+n.ewmtop;break;case 1:i=t*w+w-n.round+n.margin+n.ewmleft,a=e*w+n.round+n.margin+n.ewmtop,o.arc(i,a,n.round,1.5*Math.PI,2*Math.PI,!1),i=t*w+w+n.margin+n.ewmleft,a=e*w+n.margin+n.ewmtop;break;case 2:i=t*w+w-n.round+n.margin+n.ewmleft,a=e*w+w-n.round+n.margin+n.ewmtop,o.arc(i,a,n.round,0,Math.PI/2,!1),i=t*w+w+n.margin+n.ewmleft,a=e*w+w+n.margin+n.ewmtop;break;case 3:i=t*w+n.round+n.margin+n.ewmleft,a=e*w+w-n.round+n.margin+n.ewmtop,o.arc(i,a,n.round,Math.PI/2,Math.PI,!1),i=t*w+n.margin+n.ewmleft,a=e*w+w+n.margin+n.ewmtop}o.lineTo(i,a),o.closePath(),null!=n.foreground?A(o):(o.fill(),o.stroke())},I=function(o,t,e){var l,r=n.inptColor?n.inptColor:n.fgColor,i=n.ptColor?n.ptColor:n.fgColor;return l=o>=2&&5>o&&t>=2&&5>t?r:7>o&&7>t?i:o>=e-5&&e-2>o&&t>=2&5>t?r:o>=e-7&&e>o&&t>=0&7>t?i:o>=2&&5>o&&t>=e-5&e-2>t?r:o>=0&&7>o&&t>=e-7&e>t?i:n.fgColor},F=function(o,t,e,l,r){o.save();var n=o.getImageData(t,e,l,r),a=o.createImageData(n.width,n.height),g=n.data,m=a.data,w=n.data.length,f=n.width;for(i=0;w>i;i+=4){var h=Math.floor(i/f/4),d=i%(4*f),c=d*f+4*(f-h-1);m[c]=g[i],m[c+1]=g[i+1],m[c+2]=g[i+2],m[c+3]=g[i+3]}o.putImageData(a,t,e),o.restore()}}var logoSizeChange=!1,ewmSizeChange=!1,ewmcsh=!1;